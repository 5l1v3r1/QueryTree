function setVisibility(){var n=$("#database-type option:selected").text();n=="MySQL"||n=="PostgreSQL"?$(".ssh-available").show():$(".ssh-available").hide();$("#use-ssh").is(":checked")?($(".ssh").show(),$("#use-ssh-key").is(":checked")?($(".ssh-key").show(),$(".ssh-password").hide(),$("#SshKeyFileID").val()==""?($("#not-uploaded").show(),$("#uploaded").hide()):($("#not-uploaded").hide(),$("#uploaded").show())):($(".ssh-key").hide(),$(".ssh-password").show())):$(".ssh").hide()}function setDefaultPort(){var n=$("#database-type option:selected").text();n=="MySQL"?$("#database-port").val("3306"):n=="PostgreSQL"?$("#database-port").val("5432"):$("#database-port").val("1433")}function setSshKeyFileLink(){}function clearInputFile(){var n=document.getElementById("key-file");if(n.value){try{n.value=""}catch(u){}if(n.value){var t=document.createElement("form"),i=n.parentNode,r=n.nextSibling;t.appendChild(n);t.reset();i.insertBefore(n,r)}}}jQuery.validator.defaults.onfocusout=function(n){$(n).attr("id")!="key-file"&&this.element(n)};jQuery.validator.defaults.onkeyup=function(n){$(n).attr("id")!="key-file"&&this.element(n)};jQuery.validator.addMethod("sshkeyfile",function(){return!$("#use-ssh-key").is(":checked")||$("#SshKeyFileID").val()!=""},"");jQuery.validator.unobtrusive.adapters.add("sshkeyfile",{},function(n){n.rules.sshkeyfile=!0;n.messages.sshkeyfile=n.message});$(document).ready(function(){$(document).on("invalid-form.validate","form",function(){var n=$(this).find("#btnCreate");setTimeout(function(){n.removeAttr("disabled")},1)});$(document).on("submit","form",function(){var n=$(this).find("#btnCreate");setTimeout(function(){n.attr("disabled","disabled")},0)});$(".qt-description-container").each(function(){var n=$(this),t=function(){n.children().each(function(){var t=$(this),i=n.width()-parseInt(t.css("paddingLeft"))-parseInt(t.css("paddingRight"))-parseInt(t.css("marginLeft"))-parseInt(t.css("marginRight"))-parseInt(t.css("borderLeftWidth"))-parseInt(t.css("borderRightWidth"));t.css("width",i)})};t();$(window).resize(t)});var n=function(){var n=$("#"+$(this).attr("aria-describedby")),t=$(".qt-description-content:not(#"+n.attr("id")+")");$(".qt-description-container").show();n.show();t.hide()};$("[aria-describedby]").focus(n).hover(n);setVisibility();setDefaultPort();$("#database-type").change(setDefaultPort);$("#use-ssh").click(setVisibility);$("#use-ssh-key").change(setVisibility);$("#database-type").change(setVisibility);$("#change-key-file").click(function(){$("#SshKeyFileID").val("");clearInputFile();setVisibility()});$("#key-file").change(function(){var t=document.getElementById("key-file").files,n;t.length>0&&(n=new FormData,n.append("key-file",t[0]),$.ajax({type:"POST",url:sshUploadUrl,data:n,dataType:"json",contentType:!1,processData:!1,success:function(n){n&&n.status&&n.status=="ok"&&n.sshKeyFileID?($("#SshKeyFileID").val(n.sshKeyFileID),$("#filename").text(n.filename),raiseSuccessAlert("upload-msg","Successfully uploaded key file")):($("#SshKeyFileID").val(""),$("#filename").text(""),raiseErrorAlert("upload-msg",n.message?n.message:"An error occurred while uploading the file, please try again"),clearInputFile());setVisibility()},error:function(){$("#SshKeyFileID").val("");$("#filename").text("");raiseErrorAlert("upload-msg","An error occurred while uploading the file, please try again");clearInputFile();setVisibility()}}))});$("#use-ssh").change(function(){$(this).is(":checked")?($("[name='SshPort']").rules("add",{required:!0}),$("[name='SshUsername']").rules("add",{required:!0})):($("[name='SshPort']").rules("remove","required"),$("[name='SshUsername']").rules("remove","required"))});$("#testconnection").click(function(){var n=$("#mainForm").find(":enabled");$("#testconnection").val("Connecting...");var t=$("[name='Server']").val(),i=$("[name='Port']").val(),r=$("[name='Username']").val(),u=$("[name='DbPssword']").val(),f=$("[name='Type']").val(),e=$("[name='UseSsh']").is(":checked"),o=$("[name='SshPort']").val(),s=$("[name='SshUsername']").val(),h=$("[name='SshPassword']").val(),c=$("[name='UseSshKey']").is(":checked"),l=$("[name='SshKeyFileID']").val(),a=$("[name='DatabaseName']").val(),v=$("[name='DatabaseConnectionID']").val();n.attr("disabled",!0);$.ajax({url:testConnectionUrl,data:{server:t,port:i,username:r,password:u,type:f,useSsh:e,sshPort:o,sshUsername:s,sshPassword:h,SshKeyFileID:l,UseSshKey:c,databaseName:a,databaseConnectionId:v},dataType:"json",type:"POST",success:function(t){n.removeAttr("disabled");$("#testconnection").val("Test this Connection");t.message=="Success"?raiseSuccessAlert("testconnection-msg","Successfully connected to database"):raiseErrorAlert("testconnection-msg",t.message,0)},error:function(){n.removeAttr("disabled");$("#testconnection").val("Test this Connection");raiseErrorAlert("testconnection-msg","Failed to connect")}})})});